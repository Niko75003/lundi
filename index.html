<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tirage au sort ‚Äî R√©union du lundi</title>

    <style>
      :root {
        --bg: #0b1020;
        --card: #121a33;
        --muted: #8ea0c6;
        --text: #eaf0ff;
        --accent: #5eead4;
        --danger: #fb7185;
        --border: rgba(255, 255, 255, 0.12);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(1000px 500px at 20% 0%, rgba(94, 234, 212, 0.15), transparent 60%),
          radial-gradient(800px 500px at 80% 10%, rgba(96, 165, 250, 0.15), transparent 60%), var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }

      .wrap {
        width: min(1100px, 100%);
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 18px;
      }

      @media (max-width: 900px) {
        .wrap {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background: rgba(18, 26, 51, 0.85);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      header {
        padding: 16px 16px 12px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
      }

      header h1 {
        margin: 0;
        font-size: 16px;
        letter-spacing: 0.2px;
      }

      header p {
        margin: 6px 0 0 0;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }

      .actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      button {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.06s ease, background 0.15s ease, border-color 0.15s ease;
        user-select: none;
        white-space: nowrap;
      }

      button:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      button:active {
        transform: translateY(1px);
      }

      button.primary {
        background: rgba(94, 234, 212, 0.15);
        border-color: rgba(94, 234, 212, 0.35);
      }

      button.primary:hover {
        background: rgba(94, 234, 212, 0.22);
      }

      button.danger {
        background: rgba(251, 113, 133, 0.12);
        border-color: rgba(251, 113, 133, 0.35);
      }

      button.danger:hover {
        background: rgba(251, 113, 133, 0.18);
      }

      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
      }

      .content {
        padding: 14px 16px 16px 16px;
      }

      .list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 62vh;
        overflow: auto;
        padding-right: 6px;
      }

      .person {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.04);
      }

      .avatar {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 1px solid var(--border);
        object-fit: cover;
        background: rgba(255, 255, 255, 0.06);
        flex: 0 0 auto;
      }

      .name {
        font-weight: 700;
        font-size: 13px;
        line-height: 1.1;
      }

      .meta {
        font-size: 12px;
        color: var(--muted);
        margin-top: 3px;
      }

      .grow {
        flex: 1 1 auto;
        min-width: 0;
      }

      .toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 0 0 auto;
        font-size: 12px;
        color: var(--muted);
      }

      input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
        cursor: pointer;
      }

      .stage {
        padding: 18px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        min-height: 280px;
      }

      .big {
         display: flex;
         gap: 20px;
         align-items: center;
         justify-content: center;   /* centre verticalement */
         padding: 24px;
         min-height: 260px;         /* ‚Üê HAUTEUR ICI */
         border-radius: 22px;
         border: 1px solid var(--border);
         background: rgba(255, 255, 255, 0.04);
      }

      .big .avatar {
        width: 180px;
        height: 180px;
        border-radius: 24px;
        /* Avatar du gagnant : pas de cadre, pas de fond */
        border: none;
        background: transparent;

      }

      .big .name {
        font-size: 28px;
        font-weight: 800;
      }

      .big .meta {
        font-size: 12px;
      }

      .ticker {
        display: flex;
        gap: 10px;
        overflow: hidden;
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.03);
      }

      .chip {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        flex: 0 0 auto;
        opacity: 0.65;
        transform: scale(0.98);
        transition: opacity 0.12s ease, transform 0.12s ease, border-color 0.12s ease;
      }

      .chip.active {
        opacity: 1;
        transform: scale(1.02);
        border-color: rgba(94, 234, 212, 0.45);
        background: rgba(94, 234, 212, 0.1);
      }

      .chip img {
        width: 26px;
        height: 26px;
        border-radius: 10px;
        object-fit: cover;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
      }

      .chip span {
        font-size: 12px;
        font-weight: 700;
      }

      .hint {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }

      .footerRow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-top: auto;
        padding-top: 6px;
      }

      .count {
        color: var(--muted);
        font-size: 12px;
      }

      .winnerGlow {
        box-shadow: 0 0 0 2px rgba(94, 234, 212, 0.2), 0 18px 50px rgba(94, 234, 212, 0.15);
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <!-- Panel gauche: pr√©sence -->
      <section class="panel">
        <header>
          <div>
            <h1>Pr√©sences</h1>
            <p>Coche au d√©but de la r√©union. Le tirage ne prend que les personnes pr√©sentes.</p>
          </div>
          <div class="actions">
            <button id="allOn">Tout cocher</button>
            <button id="allOff" class="danger">Tout d√©cocher</button>
          </div>
        </header>
        <div class="content">
          <div class="list" id="list"></div>
        </div>
      </section>

      <!-- Panel droite: tirage -->
      <section class="panel">
        <header>
          <div>
            <h1>Tirage au sort</h1>
          </div>
          <div class="actions">
            <button id="drawBtn" class="primary">Lancer üé≤</button>
            <button id="resetBtn">Reset</button>
          </div>
        </header>

        <div class="stage">
          <div class="big" id="winnerCard">
            <img class="avatar" id="winnerImg" alt="" />
            <div class="grow">
              <div class="name" id="winnerName">‚Äî</div>
              <div class="meta" id="winnerMeta">Pr√™t pour le tirage.</div>
            </div>
          </div>

          <div class="ticker" id="ticker"></div>

          <div class="footerRow">
            <div class="hint" id="hint">
            </div>
            <div class="count" id="count">0 pr√©sent(s)</div>
          </div>
        </div>
      </section>
    </div>

    <script>
      // 1) CONFIG : mets ici ton √©quipe
      // photo: chemin relatif (ex: "photos/alice.jpg")
      const PEOPLE = [
        { id: "Agathe", name: "Agathe", role: "Gestion de projet", photo: "photos/Agathe.png" },
        { id: "Agnes", name: "Agn√®s", role: "Studio", photo: "photos/Agnes.png" },
        { id: "Alienor", name: "Ali√©nor", role: "Gestion de projet", photo: "photos/Alienor.png" },
        { id: "Annabelle", name: "Annabelle", role: "Direction", photo: "photos/Annabelle.png" },
        { id: "Anne", name: "Anne", role: "Gestion de projet", photo: "photos/Anne.png" },
        { id: "Barbara", name: "Barbara", role: "Gestion de projet", photo: "photos/Barbara.png" },
        { id: "Camille", name: "Camille", role: "Studio", photo: "photos/Camille.png" },
        { id: "Capucine", name: "Capucine", role: "Gestion de projet", photo: "photos/Capucine.png" },
        { id: "C√©line", name: "C√©line", role: "Direction", photo: "photos/Celine.png" },
        { id: "Chloe", name: "Chlo√©", role: "Studio", photo: "photos/Chloe.png" },
        { id: "Claire", name: "Claire", role: "Studio", photo: "photos/Claire.png" },
        { id: "Clement", name: "Cl√©ment", role: "Studio", photo: "photos/Clement.png" },
        { id: "Julie", name: "Julie", role: "Studio", photo: "photos/Julie.png" },
        { id: "Lili", name: "Lili", role: "Studio", photo: "photos/Lili.png" },
        { id: "Lisa", name: "Lisa", role: "Studio", photo: "photos/Lisa.png" },
        { id: "Nicolas", name: "Nicolas", role: "Direction", photo: "photos/Nicolas.png" },
        { id: "Sandrine", name: "Sandrine", role: "Direction", photo: "photos/Sandrine.png" },
        { id: "Margaux", name: "Margaux", role: "Gestion de projet", photo: "photos/Margaux.png" },
        { id: "MarieA", name: "Marie", role: "Gestion de projet", photo: "photos/MarieA.png" },
        { id: "MarieB", name: "Marie", role: "Gestion de projet", photo: "photos/MarieB.png" },
        { id: "MarieM", name: "Marie", role: "Gestion de projet", photo: "photos/MarieM.png" },
        { id: "Olivier", name: "Olivier", role: "Studio", photo: "photos/Olivier.png" },
        { id: "Romane", name: "Romane", role: "Gestion de projet", photo: "photos/Romane.png" },
        { id: "Vincent", name: "Vincent", role: "Gestion de projet", photo: "photos/Vincent.png" },      
      ];

      // Avatar neutre (inline SVG, pas besoin de fichier)
      const FALLBACK_AVATAR =
        "data:image/svg+xml;utf8," +
        encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#243052"/>
                <stop offset="1" stop-color="#141b33"/>
              </linearGradient>
            </defs>
            <rect width="160" height="160" rx="28" fill="url(#g)"/>
            <circle cx="80" cy="62" r="26" fill="rgba(255,255,255,0.22)"/>
            <rect x="36" y="98" width="88" height="42" rx="21" fill="rgba(255,255,255,0.18)"/>
          </svg>
        `);

      // 2) √âTAT
      const state = {
        present: new Map(), // id -> boolean
        isDrawing: false,
        lastWinnerId: null,
      };

      // 3) ELEMENTS
      const listEl = document.getElementById("list");
      const tickerEl = document.getElementById("ticker");
      const drawBtn = document.getElementById("drawBtn");
      const resetBtn = document.getElementById("resetBtn");
      const allOnBtn = document.getElementById("allOn");
      const allOffBtn = document.getElementById("allOff");
      const countEl = document.getElementById("count");

      const winnerCard = document.getElementById("winnerCard");
      const winnerImg = document.getElementById("winnerImg");
      const winnerName = document.getElementById("winnerName");
      const winnerMeta = document.getElementById("winnerMeta");

      // 4) INIT
      function init() {
        // d√©faut : tout le monde pr√©sent
        PEOPLE.forEach((p) => state.present.set(p.id, true));
        renderList();
        renderTicker(getPresentPeople());
        updateCount();
        setWinner(null);
      }

      function getPresentPeople() {
        return PEOPLE.filter((p) => state.present.get(p.id));
      }

      function updateCount() {
        const n = getPresentPeople().length;
        countEl.textContent = `${n} pr√©sent(s)`;
        drawBtn.disabled = n === 0 || state.isDrawing;
        allOnBtn.disabled = state.isDrawing;
        allOffBtn.disabled = state.isDrawing;
        resetBtn.disabled = state.isDrawing;
      }

      // 5) UI RENDER
      function renderList() {
        listEl.innerHTML = "";
        PEOPLE.forEach((p) => {
          const row = document.createElement("div");
          row.className = "person";

          const img = document.createElement("img");
          img.className = "avatar";
          img.alt = p.name;
          img.src = p.photo || FALLBACK_AVATAR;
          img.onerror = () => {
            img.src = FALLBACK_AVATAR;
          };

          const grow = document.createElement("div");
          grow.className = "grow";

          const name = document.createElement("div");
          name.className = "name";
          name.textContent = p.name;

          const meta = document.createElement("div");
          meta.className = "meta";
          meta.textContent = p.role || "";

          grow.appendChild(name);
          grow.appendChild(meta);

          const toggle = document.createElement("label");
          toggle.className = "toggle";

          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.checked = !!state.present.get(p.id);
          cb.addEventListener("change", () => {
            state.present.set(p.id, cb.checked);
            renderTicker(getPresentPeople());
            updateCount();
          });

          const t = document.createElement("span");
          t.textContent = cb.checked ? "pr√©sent" : "absent";
          cb.addEventListener("change", () => {
            t.textContent = cb.checked ? "pr√©sent" : "absent";
          });

          toggle.appendChild(cb);
          toggle.appendChild(t);

          row.appendChild(img);
          row.appendChild(grow);
          row.appendChild(toggle);

          listEl.appendChild(row);
        });
      }

      function renderTicker(pool) {
        tickerEl.innerHTML = "";
        // On duplique pour que l'animation ait "de la mati√®re"
        const items = [...pool, ...pool, ...pool].slice(0, Math.max(12, pool.length * 3));
        items.forEach((p, idx) => {
          const chip = document.createElement("div");
          chip.className = "chip";
          chip.dataset.id = p.id;
          chip.dataset.idx = String(idx);

          const img = document.createElement("img");
          img.alt = p.name;
          img.src = p.photo || FALLBACK_AVATAR;
          img.onerror = () => {
            img.src = FALLBACK_AVATAR;
          };

          const span = document.createElement("span");
          span.textContent = p.name;

          chip.appendChild(img);
          chip.appendChild(span);
          tickerEl.appendChild(chip);
        });
      }

      function setWinner(person) {
        winnerCard.classList.remove("winnerGlow");

        if (!person) {
          winnerImg.src = FALLBACK_AVATAR;
          winnerName.textContent = "‚Äî";
          winnerMeta.textContent = "Pr√™t pour le tirage.";
          return;
        }

        winnerImg.src = person.photo || FALLBACK_AVATAR;
        winnerImg.onerror = () => {
          winnerImg.src = FALLBACK_AVATAR;
        };
        winnerName.textContent = person.name;
        winnerMeta.textContent = person.role ? person.role : "S√©lectionn√©¬∑e";
        winnerCard.classList.add("winnerGlow");
      }

      // 6) RANDOM DRAW
      function pickRandom(pool) {
        // √©vite de retomber sur le dernier gagnant si possible
        if (pool.length <= 1) return pool[0] || null;

        let p;
        for (let i = 0; i < 10; i++) {
          p = pool[Math.floor(Math.random() * pool.length)];
          if (p.id !== state.lastWinnerId) break;
        }
        return p;
      }

      async function draw() {
        const pool = getPresentPeople();
        if (pool.length === 0) return;

        state.isDrawing = true;
        updateCount();

        // refresh ticker in case
        renderTicker(pool);

        // choisit gagnant
        const winner = pickRandom(pool);
        state.lastWinnerId = winner.id;

        // animation: on "surbrille" des chips successifs
        const chips = Array.from(tickerEl.querySelectorAll(".chip"));
        if (chips.length === 0) {
          setWinner(winner);
          state.isDrawing = false;
          updateCount();
          return;
        }

        // on veut s'arr√™ter sur un chip qui correspond au gagnant
        const targetIndexes = chips
          .map((c, i) => ({ c, i }))
          .filter((x) => x.c.dataset.id === winner.id)
          .map((x) => x.i);

        const target = targetIndexes.length ? targetIndexes[targetIndexes.length - 1] : Math.min(chips.length - 1, 8);

        // "tours" complets avant l'arr√™t
        const baseSpins = Math.min(6, chips.length - 1);
        const finalStop = Math.min(chips.length - 1, baseSpins + target);

        // on active successivement
        let delay = 20; // d√©part rapide
        let delayGrowth = 1.20; // ralentissement

        for (let i = 0; i <= finalStop; i++) {
          chips.forEach((ch) => ch.classList.remove("active"));
          const current = chips[i % chips.length];
          current.classList.add("active");

          // scroll auto pour garder visible
          current.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });

          await new Promise((r) => setTimeout(r, delay));
          delay = Math.min(100, Math.floor(delay * delayGrowth));
        }

        // r√©sultat
        setWinner(winner);
        
        // Force la surbrillance sur la chip du gagnant (pour √©viter tout d√©calage visuel)
        chips.forEach((ch) => ch.classList.remove("active"));
        const winnerChip = chips.find((ch) => ch.dataset.id === winner.id);
        if (winnerChip) {
          winnerChip.classList.add("active");
          winnerChip.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });
      }

        state.isDrawing = false;
        updateCount();
      }

      function setAll(val) {
        PEOPLE.forEach((p) => state.present.set(p.id, val));
        renderList();
        renderTicker(getPresentPeople());
        updateCount();
      }

      function reset() {
        state.lastWinnerId = null;
        setWinner(null);
        const chips = Array.from(tickerEl.querySelectorAll(".chip"));
        chips.forEach((ch) => ch.classList.remove("active"));
      }

      // 7) EVENTS
      drawBtn.addEventListener("click", draw);
      resetBtn.addEventListener("click", reset);
      allOnBtn.addEventListener("click", () => setAll(true));
      allOffBtn.addEventListener("click", () => setAll(false));

      init();
    </script>
  </body>
</html>
